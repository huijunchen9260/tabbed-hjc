From 85632ec8d05655d1398da9d1ed297e8aeef8ff52 Mon Sep 17 00:00:00 2001
From: Larry <fake_larry@protonmail.com>
Date: Wed, 14 Aug 2019 23:49:34 +0000
Subject: [PATCH] Mixed tabs.

Added the ability to change spawned programs with a keybinding.
---
 config.def.h | 41 +++++++++++++++++++++++++++++++++++++++++
 tabbed.c     |  1 +
 2 files changed, 42 insertions(+)

diff --git a/config.def.h b/config.def.h
index defa426..3846b1f 100644
--- a/config.def.h
+++ b/config.def.h
@@ -33,6 +33,43 @@ static Bool npisrelative  = False;
         } \
 }

+struct prog {
+	const Arg argv;
+	const int replace;
+};
+
+static const struct prog progs[] = {
+	{ { .v = (const char *[]){ "st", "-t", "Not vim", "-w", NULL } }, 0 },
+	{ { .v = (const char *[]){ "st", "-t", "vim", "-w", "", "-e", "vim", NULL } }, 4 },
+	{ { .v = (const char *[]){ "st", "-w", NULL } }, 0},
+	{ { .v = (const char *[]){ "dmenu_run", NULL } }, 0},
+};
+
+
+static void
+setprog(const Arg *arg)
+{
+	const struct prog *p = arg->v;
+	int argc;
+	const char **s;
+
+	for (argc = 0, s = p->argv.v; *s++; argc++)
+		;
+
+	setcmd(argc, p->argv.v, p->replace);
+}
+
+static void
+spawnprog(const Arg *arg)
+{
+	char **const oldcmd = cmd;
+
+	cmd = NULL;
+	setprog(arg);
+	spawn(NULL);
+
+	cmd = oldcmd;
+}
+
 #define MODKEY ControlMask
 static Key keys[] = {
 	/* modifier             key        function     argument */
@@ -44,6 +81,10 @@ static Key keys[] = {
 	{ MODKEY|ShiftMask,     XK_j,      movetab,     { .i = -1 } },
 	{ MODKEY|ShiftMask,     XK_k,      movetab,     { .i = +1 } },
 	{ MODKEY,               XK_Tab,    rotate,      { .i = 0 } },
+	{ MODKEY,               XK_g,      setprog,     { .v = &progs[0] } },
+	{ MODKEY|ShiftMask,     XK_g,      setprog,     { .v = &progs[1] } },
+	{ MODKEY,               XK_t,      spawnprog,   { .v = &progs[0] } },
+	{ MODKEY|ShiftMask,     XK_t,      spawnprog,   { .v = &progs[1] } },

 	{ MODKEY,               XK_grave,  spawn,       SETPROP("_TABBED_SELECT_TAB") },
 	{ MODKEY,               XK_1,      move,        { .i = 0 } },
diff --git a/tabbed.c b/tabbed.c
index ff3ada0..daf5175 100644
--- a/tabbed.c
+++ b/tabbed.c
@@ -950,6 +950,7 @@ setcmd(int argc, char *argv[], int replace)
 {
 	int i;

+	free(cmd); /* free potential memory leak */
 	cmd = ecalloc(argc + 3, sizeof(*cmd));
 	if (argc == 0)
 		return;
--
2.21.0
